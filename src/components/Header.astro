---
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/features/', label: 'Features' },
  { href: '/pricing/', label: 'Pricing' },
  { href: '/download/', label: 'Download' },
  { href: '/docs/', label: 'Docs' },
  { href: '/contact/', label: 'Contact' },
];

function isActive(href: string, current: string): boolean {
  if (href === '/') return current === '/' || current === '';
  return current.startsWith(href);
}
---

<header class="sticky top-0 z-50 border-b border-navy-700/50 bg-navy-950/90 backdrop-blur-md" role="banner">
  <nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8" aria-label="Main navigation">
    <div class="flex h-16 items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 text-xl font-bold text-white" aria-label="DonjonSec home">
        <svg class="h-8 w-8" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <rect width="32" height="32" rx="6" fill="#0891b2" />
          <path d="M8 8h6a8 8 0 010 16H8V8z" stroke="white" stroke-width="2.5" fill="none" />
          <circle cx="22" cy="16" r="3" fill="white" />
        </svg>
        <span>Donjon<span class="text-cyan-400">Sec</span></span>
      </a>

      <!-- Desktop Nav -->
      <div class="hidden md:flex md:items-center md:gap-1">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'px-3 py-2 rounded-md text-sm font-medium transition-colors',
              isActive(link.href, currentPath)
                ? 'text-cyan-400 bg-navy-800'
                : 'text-slate-300 hover:text-white hover:bg-navy-800/50',
            ]}
            aria-current={isActive(link.href, currentPath) ? 'page' : undefined}
          >
            {link.label}
          </a>
        ))}
        <a
          href="/download/"
          class="ml-3 inline-flex items-center rounded-md bg-cyan-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-cyan-500 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-400"
        >
          Get Started
        </a>
      </div>

      <!-- Mobile menu button -->
      <button
        type="button"
        class="md:hidden inline-flex items-center justify-center rounded-md p-2 text-slate-300 hover:text-white hover:bg-navy-800 transition-colors"
        aria-expanded="false"
        aria-controls="mobile-menu"
        id="mobile-menu-button"
        aria-label="Open main menu"
      >
        <svg class="h-6 w-6" id="menu-icon-open" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
        <svg class="h-6 w-6 hidden" id="menu-icon-close" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Mobile Nav -->
    <div class="hidden md:hidden" id="mobile-menu" role="menu">
      <div class="space-y-1 px-2 pb-4 pt-2">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'block rounded-md px-3 py-2 text-base font-medium transition-colors',
              isActive(link.href, currentPath)
                ? 'text-cyan-400 bg-navy-800'
                : 'text-slate-300 hover:text-white hover:bg-navy-800/50',
            ]}
            role="menuitem"
            aria-current={isActive(link.href, currentPath) ? 'page' : undefined}
          >
            {link.label}
          </a>
        ))}
        <a
          href="/download/"
          class="block rounded-md bg-cyan-600 px-3 py-2 text-base font-semibold text-white text-center mt-2 hover:bg-cyan-500 transition-colors"
          role="menuitem"
        >
          Get Started
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  if (button && menu && iconOpen && iconClose) {
    button.addEventListener('click', () => {
      const expanded = button.getAttribute('aria-expanded') === 'true';
      button.setAttribute('aria-expanded', String(!expanded));
      button.setAttribute('aria-label', expanded ? 'Open main menu' : 'Close main menu');
      menu.classList.toggle('hidden');
      iconOpen.classList.toggle('hidden');
      iconClose.classList.toggle('hidden');
    });
  }
</script>
